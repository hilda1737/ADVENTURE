var __SPOTIM__;(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const o=window.__SPOTIM__.lib.react;var n=e.n(o);const s=window.__SPOTIM__.lib.ReactDom;var a=e.n(s);const r=window.__SPOTIM__.SERVICES.configProvider;var c=e.n(r);function i({counter:e}){return n().createElement("div",{className:"messages-count",onClick:function(){const e=document.querySelector('div[data-spotim-app="conversation"]');e&&e.scrollIntoView()}},n().createElement("a",{href:"javascript:void(0)"},e))}function d({spotId:e,postId:t,counterMessage:o}){return o<0?null:n().createElement(i,{counter:o})}const u=window.__SPOTIM__.lib.bootstrapHelpers,l=window.__SPOTIM__.lib.request;var p=e.n(l);const _=async(e,t)=>await p()("v1.0.0/conversation/count",{method:"POST",headers:{"Content-Type":"application/json","x-spot-id":e,"x-post-id":"default"},body:JSON.stringify({conversation_ids:t})});async function m(e){let t=document.querySelectorAll("[data-spotim-module=messages-count]");if(0===t.length&&(t=document.querySelectorAll(".spot-im-replies-count")),t.length){const o=[],s=c().get("spotId");async function r(){const r=await _(s,o);Object.keys(t).forEach((o=>{const c=t[o].dataset.postId;if(!e||e===c){const e=r.counts[`${s}_${c}`].comments,i=r.counts[`${s}_${c}`].replies,u=parseInt(e)+parseInt(i);s&&c&&a().render(n().createElement(d,{spotId:s,postId:c,counterMessage:u}),t[o])}}))}Object.keys(t).forEach((n=>{const a=t[n].dataset.postId;e&&e!==a||o.push(`${s}_${a}`)})),r()}window.SPOTIM.getMessagesCount=async function({spotId:e,postId:t}){const o=[`${e}_${t}`],n=await _(e,o),s=n.counts[`${e}_${t}`].comments,a=n.counts[`${e}_${t}`].replies,r=parseInt(s)+parseInt(a);return window.spotimSafeframe&&window.spotimSafeframe.sendMessageToHost({action:"messages-count",args:r}),r}}(0,u.reactToElement)({selector:"[data-spotim-module=messages-count],[class=spot-im-replies-count]",onAdded:e=>{},onAttributesChanged:(e,t)=>{const o=t.map((e=>e.attributeName)).includes("data-post-id"),n=e.dataset.postId;o&&n&&m(n)},onRemoved:()=>{}}),m(),(__SPOTIM__=void 0===__SPOTIM__?{}:__SPOTIM__).apps=t})();
//# sourceMappingURL=messages-count-bundle.js.map